<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Juan David Ospina Arango" />


<title>Sesión 04</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Analítica Predictiva</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Introducción</a>
</li>
<li>
  <a href="about.html">Sesiones de clase</a>
</li>
<li>
  <a href="Preguntasrespuestas.html">Preguntas y respuestas</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Sesión 04</h1>
<h4 class="author">Juan David Ospina Arango</h4>
<h4 class="date">6/4/2020</h4>

</div>


<div id="r-markdown" class="section level2">
<h2>R Markdown</h2>
<pre class="r"><code>library(readr)
datos &lt;- read_delim(&quot;real_estate_valuation_dataset.csv&quot;, 
    &quot;;&quot;, escape_double = FALSE, locale = locale(decimal_mark = &quot;,&quot;, 
        grouping_mark = &quot;&quot;), trim_ws = TRUE)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   No = col_double(),
##   X1 = col_double(),
##   X2 = col_double(),
##   X3 = col_double(),
##   X4 = col_double(),
##   X5 = col_double(),
##   X6 = col_double(),
##   Y = col_double()
## )</code></pre>
<pre class="r"><code>summary(datos)</code></pre>
<pre><code>##        No              X1             X2               X3                X4        
##  Min.   :  1.0   Min.   :2013   Min.   : 0.000   Min.   :  23.38   Min.   : 0.000  
##  1st Qu.:104.2   1st Qu.:2013   1st Qu.: 9.025   1st Qu.: 289.32   1st Qu.: 1.000  
##  Median :207.5   Median :2013   Median :16.100   Median : 492.23   Median : 4.000  
##  Mean   :207.5   Mean   :2013   Mean   :17.713   Mean   :1083.89   Mean   : 4.094  
##  3rd Qu.:310.8   3rd Qu.:2013   3rd Qu.:28.150   3rd Qu.:1454.28   3rd Qu.: 6.000  
##  Max.   :414.0   Max.   :2014   Max.   :43.800   Max.   :6488.02   Max.   :10.000  
##        X5              X6              Y         
##  Min.   :24.93   Min.   :121.5   Min.   :  7.60  
##  1st Qu.:24.96   1st Qu.:121.5   1st Qu.: 27.70  
##  Median :24.97   Median :121.5   Median : 38.45  
##  Mean   :24.97   Mean   :121.5   Mean   : 37.98  
##  3rd Qu.:24.98   3rd Qu.:121.5   3rd Qu.: 46.60  
##  Max.   :25.01   Max.   :121.6   Max.   :117.50</code></pre>
<p>No: número del registro X1: Año del negocio X2: edad de la casa (años) X3: distancia al transporte masivo (m) X4: número de tiendas de conveniencia alrededor X5: latitud X6: longitud Y: variable respuesta, precio ($/m2)</p>
<pre class="r"><code>datos_an&lt;-subset(datos,select=c(&quot;X2&quot;,&quot;X3&quot;,&quot;X4&quot;,&quot;Y&quot;))
# datos_an&lt;-datos[,c(2:5,8)]
# datos_an&lt;-datos[,c(&quot;X2&quot;,&quot;X3&quot;,&quot;X4&quot;,&quot;Y&quot;)]
head(datos_an)</code></pre>
<pre><code>## # A tibble: 6 x 4
##      X2     X3    X4     Y
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  32     84.9    10  37.9
## 2  19.5  307.      9  42.2
## 3  13.3  562.      5  47.3
## 4  13.3  562.      5  54.8
## 5   5    391.      5  43.1
## 6   7.1 2175.      3  32.1</code></pre>
<p>Objetivos: 1. Predecir el precio por metro cuadrado de una vivienda en función de ciertas características (edad de la propiedad, la distancia al transporte y el número de comercios alrededor)</p>
<p>Preguntas: ¿Afecta la edad de la casa su valor? ¿Dónde se sitúan las casas con mejores características? ¿Se están pagando impuestos correctamente?</p>
<p>¿Tengo toda la información necesaria para resolver mi problema de predicción? No. Probablemente no tenemos toda la información para hacer el mejor modelo. Información como el número de baños y otras comodidades serían complementarias para hacer un buen modelo.</p>
<pre class="r"><code>panel.hist &lt;- function(x, ...)
{
    usr &lt;- par(&quot;usr&quot;); on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5) )
    h &lt;- hist(x, plot = FALSE)
    breaks &lt;- h$breaks; nB &lt;- length(breaks)
    y &lt;- h$counts; y &lt;- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = &quot;cyan&quot;, ...)
}
panel.cor &lt;- function(x, y, digits = 2, prefix = &quot;&quot;, cex.cor, ...)
{
    usr &lt;- par(&quot;usr&quot;); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r &lt;- abs(cor(x, y))
    txt &lt;- format(c(r, 0.123456789), digits = digits)[1]
    txt &lt;- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor &lt;- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}

pairs(datos_an,lower.panel = panel.smooth,upper.panel = panel.cor)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>plot(datos_an$X2,datos_an$Y,las=1,xlab=&quot;Edad de la casa (años)&quot;,
     ylab=&quot;Precio ($/m2)&quot;,
     main=&quot;Precio vs edad de la casa&quot;,log=&quot;xy&quot;)</code></pre>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): 17 x values &lt;= 0 omitted from
## logarithmic plot</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>plot(datos_an$X3,datos_an$Y,las=1,xlab=&quot;Distancia al transporte (ln m)&quot;,
     ylab=&quot;Precio ($/m2)&quot;,
     main=&quot;Precio vs distancia al transporte&quot;,log=&quot;xy&quot;)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>La gráfica en escala logarítmica (para x) parece mostrar que la variabilidad en los precios disminuye a medida que las casas se sitúan lejos del transporte. Así mismo, pareciera que el precio disminuye con la distancia al transporte. Es decir, mientras más lejos del transporte menos valor tienen las casas y menos se diferencian probablemente por sus características.</p>
<pre class="r"><code>plot(datos_an$X4,datos_an$Y,las=1,xlab=&quot;Número de comercios&quot;,
     ylab=&quot;Precio ($/m2)&quot;,
     main=&quot;Precio vs número de comercios&quot;,log=&quot;xy&quot;)</code></pre>
<pre><code>## Warning in xy.coords(x, y, xlabel, ylabel, log): 67 x values &lt;= 0 omitted from
## logarithmic plot</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Transformación logarítmica:</p>
<pre class="r"><code>datos_an$X2log&lt;-log(datos_an$X2+1)
datos_an$X3log&lt;-log(datos_an$X3)
datos_an$X4log&lt;-log(datos_an$X4+1)
datos_an$Ylog&lt;-log(datos_an$Y)</code></pre>
<p>Diagrama de dispersión por pares:</p>
<pre class="r"><code>pairs(datos_an,lower.panel = panel.smooth,upper.panel = panel.cor)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>set.seed(20200604)
fachada&lt;-sample(c(&quot;muy buena&quot;,&quot;buena&quot;,&quot;regular&quot;),414,replace=TRUE)</code></pre>
<pre class="r"><code>datos$fachada&lt;-fachada</code></pre>
<pre class="r"><code>boxplot(Y~fachada,data=datos)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>boxplot(Y~X4,data=datos_an)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Escalamiento de las variables:</p>
<pre class="r"><code>datos_an_scale&lt;-scale(datos_an,center=TRUE,scale=TRUE)
medias&lt;-attr(datos_an_scale,&quot;scaled:center&quot;)
desv_Est&lt;-attr(datos_an_scale,&quot;scaled:scale&quot;)
datos_an_scale&lt;-as.data.frame(datos_an_scale)</code></pre>
<p>Gráfico de dispersión por pares con las variables escaladas:</p>
<pre class="r"><code>pairs(datos_an_scale,lower.panel = panel.smooth,upper.panel = panel.cor)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="calibración-de-un-modelo-lineal" class="section level2">
<h2>Calibración de un modelo lineal</h2>
<div id="separación-del-conjunto-de-datos-en-entrenamiento-y-validación" class="section level3">
<h3>Separación del conjunto de datos en entrenamiento y validación</h3>
<pre class="r"><code>set.seed(20200604)
p_vl&lt;-0.2 # fracción de los datos usados para la validación
N&lt;-dim(datos_an_scale)[1] # cantidad de registros
ix_vl&lt;-sample(N,ceiling(p_vl*N),replace = FALSE)
datos_tr&lt;-datos_an_scale[-ix_vl,]
datos_vl&lt;-datos_an_scale[ix_vl,]</code></pre>
</div>
<div id="ajuste-de-un-modelo-lineal" class="section level3">
<h3>Ajuste de un modelo lineal</h3>
<pre class="r"><code>modelo_lm&lt;-lm(Ylog~-1+X2log+X3log+X4log,data=datos_tr) # Ylog está centrada
summary(modelo_lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Ylog ~ -1 + X2log + X3log + X4log, data = datos_tr)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2731 -0.3120  0.0117  0.3241  2.7778 
## 
## Coefficients:
##       Estimate Std. Error t value Pr(&gt;|t|)    
## X2log -0.17068    0.03506  -4.868 1.75e-06 ***
## X3log -0.57744    0.04402 -13.118  &lt; 2e-16 ***
## X4log  0.21951    0.04381   5.010 8.91e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6107 on 328 degrees of freedom
## Multiple R-squared:  0.6342, Adjusted R-squared:  0.6308 
## F-statistic: 189.5 on 3 and 328 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot(modelo_lm,which = 6)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>modelo_lm_int&lt;-lm(Ylog~-1+X2log+X3log+X4log+X3log:X4log,data=datos_tr) # Ylog está centrada
summary(modelo_lm_int)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Ylog ~ -1 + X2log + X3log + X4log + X3log:X4log, 
##     data = datos_tr)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2335 -0.2464  0.0741  0.3523  2.7015 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## X2log       -0.16383    0.03464  -4.729 3.36e-06 ***
## X3log       -0.57305    0.04343 -13.195  &lt; 2e-16 ***
## X4log        0.19934    0.04366   4.566 7.06e-06 ***
## X3log:X4log  0.08979    0.02800   3.206  0.00148 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6023 on 327 degrees of freedom
## Multiple R-squared:  0.6453, Adjusted R-squared:  0.641 
## F-statistic: 148.7 on 4 and 327 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>anova(modelo_lm_int,modelo_lm)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: Ylog ~ -1 + X2log + X3log + X4log + X3log:X4log
## Model 2: Ylog ~ -1 + X2log + X3log + X4log
##   Res.Df    RSS Df Sum of Sq     F   Pr(&gt;F)   
## 1    327 118.61                               
## 2    328 122.34 -1   -3.7287 10.28 0.001478 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Predicciones del modelo:</p>
<pre class="r"><code>y_pred_tr_sc&lt;-predict(modelo_lm_int) # predicciones en la e</code></pre>
<p>Predichos versus observados:</p>
<pre class="r"><code>plot(y_pred_tr_sc,datos_tr$Ylog,las=1)
abline(a=1,b=1,lwd=2,col=&quot;red&quot;)</code></pre>
<p><img src="código_clase_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
